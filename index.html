<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Titan Upgrade Calculator with External Data</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .tabs { display: flex; margin-bottom: 1rem; cursor: pointer; }
  .tab { padding: 10px 20px; border: 1px solid #ccc; border-bottom: none; }
  .tab.active { background: #f0f0f0; font-weight: bold; }
  .tab-content { border: 1px solid #ccc; padding: 10px; }
  table { width: 100%; border-collapse: collapse; margin-top: 1rem;}
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center;}
  tr.upgraded { background-color: #d4f8d4; }
  tr.no-upgrade { background-color: #f8d4d4; }
  textarea { width: 100%; height: 150px; font-family: monospace; }
  label { font-weight: bold; display: block; margin-top: 1rem; }
  button { margin-top: 1rem; padding: 10px 20px; font-size: 16px; }
  .summary { margin-top: 1rem; font-weight: bold; }
  .inline-inputs { display: flex; align-items: center; gap: 10px; margin-top: 1rem; }
</style>
</head>
<body>
<div id="app">
  <div v-if="loading">Loading data...</div>
  <div v-else>
    <label for="totalPotions">Total Potions Available:</label>
    <input type="number" id="totalPotions" v-model.number="totalPotions" min="0" />

    <label>Select Titan:</label>
    <select v-model="selectedTitan">
      <option disabled value="">Select Titan</option>
      <option v-for="t in titanNames" :key="t" :value="t">{{ t }}</option>
    </select>

    <label>Number of upgrades:</label>
    <input type="number" v-model.number="upgradeCount" min="1" />

    <button @click="calculateSpecificCost">Calculate Specific Upgrade Cost</button>

    <p v-if="specificCost !== null">
      Potion cost to upgrade <strong>{{ selectedTitan }}</strong> by <strong>{{ upgradeCount }}</strong> level(s): <strong>{{ specificCost }}</strong>
    </p>
    <p v-if="specificCostError" style="color:red;">{{ specificCostError }}</p>

    <hr/>

    <button @click="calculateUpgrades">Calculate All Upgrades</button>

    <div v-if="results.length">
      <h3>Results:</h3>
      <table>
        <thead>
          <tr>
            <th>Titan</th>
            <th>Initial Level</th>
            <th>Final Level</th>
            <th>Total Upgrade Cost</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="item in results" :key="item.titan">
            <td>{{ item.titan }}</td>
            <td>{{ item.initialLevel }}</td>
            <td>{{ item.finalLevel }}</td>
            <td>{{ item.totalCost }}</td>
            <td>{{ item.status }}</td>
          </tr>
        </tbody>
      </table>

      <p>Total upgrades performed: {{ totalUpgrades }}</p>
      <p>Potions remaining: {{ potionsRemaining }}</p>
    </div>
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      loading: true,
      potionCostTable: {},
      titans: {},
      totalPotions: 1000,
      selectedTitan: '',
      upgradeCount: 1,
      specificCost: null,
      specificCostError: '',
      results: [],
      totalUpgrades: 0,
      potionsRemaining: 0,
    }
  },
  computed: {
    titanNames() {
      return Object.keys(this.titans)
    }
  },
  methods: {
    async loadData() {
      try {
        const [potionResp, titansResp] = await Promise.all([
          fetch('data/potion_cost_table.json'),
          fetch('data/titans.json'),
        ])
        this.potionCostTable = await potionResp.json()
        this.titans = await titansResp.json()
      } catch (e) {
        alert("Failed to load data files. Check console for details.")
        console.error(e)
      } finally {
        this.loading = false
      }
    },
    calculateSpecificCost() {
      this.specificCostError = ''
      this.specificCost = null
      if (!this.selectedTitan) {
        this.specificCostError = 'Please select a titan.'
        return
      }
      if (!Number.isInteger(this.upgradeCount) || this.upgradeCount < 1) {
        this.specificCostError = 'Enter a valid number of upgrades (>=1).'
        return
      }

      if (!(this.selectedTitan in this.titans)) {
        this.specificCostError = `Titan '${this.selectedTitan}' not found.`
        return
      }

      const currentLevel = this.titans[this.selectedTitan]
      let totalCost = 0
      for (let i = 1; i <= this.upgradeCount; i++) {
        const nextLevel = currentLevel + i
        const cost = this.potionCostTable[nextLevel]
        if (cost === undefined) {
          this.specificCostError = `Potion cost not found for level ${nextLevel}.`
          return
        }
        totalCost += cost
      }
      this.specificCost = totalCost
    },
    calculateUpgrades() {
      let titanLevels = { ...this.titans }
      let upgrades = {}
      let potionsLeft = this.totalPotions
      let potionsSpent = {}

      for (let t in titanLevels) {
        upgrades[t] = 0
        potionsSpent[t] = 0
      }

      while (true) {
        let cheapestTitan = null
        let cheapestCost = Infinity

        for (let t in titanLevels) {
          let currentLevel = titanLevels[t]
          let nextLevel = currentLevel + 1
          let cost = this.potionCostTable[nextLevel]

          if (cost !== undefined && cost <= potionsLeft && cost < cheapestCost) {
            cheapestCost = cost
            cheapestTitan = t
          }
        }
        if (cheapestTitan === null) break

        titanLevels[cheapestTitan]++
        upgrades[cheapestTitan]++
        potionsSpent[cheapestTitan] += cheapestCost
        potionsLeft -= cheapestCost
      }

      this.results = Object.keys(titanLevels).map(titan => {
        return {
          titan,
          initialLevel: this.titans[titan],
          finalLevel: titanLevels[titan],
          totalCost: potionsSpent[titan],
          status: upgrades[titan] > 0 ? 'Upgraded' : 'No Upgrade Possible'
        }
      })

      this.totalUpgrades = Object.values(upgrades).reduce((a, b) => a + b, 0)
      this.potionsRemaining = potionsLeft
    }
  },
  mounted() {
    this.loadData()
  }
}).mount('#app')
</script>
</body>
</html>
